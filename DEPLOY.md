# CrowdfundFix — Deployment Guide

Free-tier deployment: **Frontend on Vercel**, **Backend on Render**, **SQLite database**.

---

## 1. Backend Deployment (Render)

### Prerequisites
- A free [Render](https://render.com) account
- The repository pushed to GitHub / GitLab

### Steps

1. **Create a New Web Service** on Render.
2. **Connect** your Git repository.
3. **Set Root Directory** to `backend`.
4. **Build Command:** `pip install -r requirements.txt`
5. **Start Command:** `bash start.sh`
6. **Environment:** Python 3
7. **Plan:** Free

### Environment Variables

Set these in the Render dashboard → **Environment**:

| Variable | Value |
|---|---|
| `SECRET_KEY` | *(generate a strong random string)* |
| `ALGORITHM` | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | `1440` |
| `ENVIRONMENT` | `production` |
| `FRONTEND_URL` | `https://your-app.vercel.app` |
| `DATABASE_URL` | `sqlite:///./app.db` |

> **Tip:** Render auto-generates `PORT`. The `start.sh` script already reads it.

### Verify

After deploy, visit:
- `https://your-service.onrender.com/` → should return `{"status":"CrowdfundFix API running", ...}`
- `https://your-service.onrender.com/docs` → Swagger UI

---

## 2. Frontend Deployment (Vercel)

### Prerequisites
- A free [Vercel](https://vercel.com) account
- The repository pushed to GitHub / GitLab

### Steps

1. **Import** the repository into Vercel.
2. **Framework Preset** is auto-detected as **Next.js**.
3. **Root Directory:** leave as `/` (project root).
4. **Build Command:** `npm run build` (default).
5. **Output Directory:** auto-detected.

### Environment Variables

Set in Vercel dashboard → **Settings → Environment Variables**:

| Variable | Value |
|---|---|
| `NEXT_PUBLIC_API_URL` | `https://your-service.onrender.com/api/v1` |

> Replace `your-service` with your actual Render service hostname.

### Verify

After deploy, visit your `*.vercel.app` URL. The app should load and fetch data from the backend.

---

## 3. Local Development

```bash
# Start both frontend and backend together
npm run dev:full

# Or separately:
# Terminal 1 — Backend
cd backend
source venv/bin/activate
uvicorn app.main:app --reload

# Terminal 2 — Frontend
npm run dev
```

---

## 4. Environment Variables Reference

### Backend (`backend/.env`)
```env
SECRET_KEY=changeme
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
ENVIRONMENT=development
DATABASE_URL=sqlite:///./app.db
FRONTEND_URL=http://localhost:3000
```

### Frontend (`.env.local`)
```env
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
```

---

## 5. Troubleshooting

### Backend won't start on Render
- Check the **Logs** tab in Render dashboard.
- Make sure `start.sh` is executable (`chmod +x backend/start.sh`).
- Verify all environment variables are set.

### CORS errors in browser
- Ensure `FRONTEND_URL` on the backend matches your Vercel domain exactly.
- The backend also allows `*.vercel.app` via regex, so preview deploys work automatically.

### Database resets on Render free tier
- Render free-tier instances may restart and lose the SQLite file.
- The app auto-creates tables and seeds mock data on every startup, so this is handled automatically.
- For persistence, upgrade to a Render disk or switch `DATABASE_URL` to a PostgreSQL connection string (e.g., Render Postgres free tier).

### Frontend shows mock data instead of backend data
- Verify `NEXT_PUBLIC_API_URL` is set correctly in Vercel.
- Check the browser Network tab — the frontend falls back to mock data if the API is unreachable.

### Swagger docs not accessible
- Visit `https://your-service.onrender.com/docs` — this is auto-generated by FastAPI.

---

## 6. Architecture

```
┌─────────────────┐       HTTPS        ┌──────────────────┐
│   Vercel (Free)  │  ──────────────►  │  Render (Free)    │
│   Next.js App    │                    │  FastAPI Backend   │
│                  │  ◄──────────────  │  SQLite Database   │
└─────────────────┘       JSON API      └──────────────────┘
```

Both services auto-deploy on `git push` to the connected branch.
